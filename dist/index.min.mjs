import Ze from'loglevel';import Se from'axios';var Be=Object.create;var Pe=Object.defineProperty;var Je=Object.getOwnPropertyDescriptor;var Qe=Object.getOwnPropertyNames;var Ve=Object.getPrototypeOf,Ye=Object.prototype.hasOwnProperty;var xe=(n,e)=>()=>(e||n((e={exports:{}}).exports,e),e.exports),Ge=(n,e)=>{for(var t in e)Pe(n,t,{get:e[t],enumerable:true});},Xe=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Qe(e))!Ye.call(n,s)&&s!==t&&Pe(n,s,{get:()=>e[s],enumerable:!(r=Je(e,s))||r.enumerable});return n};var be=(n,e,t)=>(t=n!=null?Be(Ve(n)):{},Xe(!n||!n.__esModule?Pe(t,"default",{value:n,enumerable:true}):t,n));var Oe=xe((nr,Ee)=>{Ee.exports={};});var Ne=xe((sr,ke)=>{ke.exports={};});var je=xe((un,Ke)=>{Ke.exports={};});var we={};Ge(we,{HTTPError:()=>E,ImportError:()=>_,MissingConfigurationError:()=>P,ObjectAlreadyExists:()=>O,ObjectNotFound:()=>x,ObjectUnprocessable:()=>k,RequestMalformed:()=>y,RequestUnauthorized:()=>N,ServerError:()=>U,TypesenseError:()=>m});var m=class extends Error{constructor(e,t,r){super(e),this.name=new.target.name,this.httpBody=t,this.httpStatus=r,Object.setPrototypeOf(this,new.target.prototype);}};var E=class extends m{};var P=class extends m{};var O=class extends m{};var x=class extends m{};var k=class extends m{};var y=class extends m{};var N=class extends m{};var U=class extends m{};var _=class extends m{constructor(e,t,r){super(e),this.importResults=t,this.payload=r;}};var q=class{constructor(e){this.nodes=e.nodes||[],this.nodes=this.nodes.map(t=>this.setDefaultPathInNode(t)).map(t=>this.setDefaultPortInNode(t)).map(t=>({...t})),e.randomizeNodes==null&&(e.randomizeNodes=true),e.randomizeNodes===true&&this.shuffleArray(this.nodes),this.nearestNode=e.nearestNode,this.nearestNode=this.setDefaultPathInNode(this.nearestNode),this.nearestNode=this.setDefaultPortInNode(this.nearestNode),this.connectionTimeoutSeconds=e.connectionTimeoutSeconds||e.timeoutSeconds||5,this.healthcheckIntervalSeconds=e.healthcheckIntervalSeconds||60,this.numRetries=(e.numRetries!==void 0&&e.numRetries>=0?e.numRetries:this.nodes.length+(this.nearestNode==null?0:1))||3,this.retryIntervalSeconds=e.retryIntervalSeconds||.1,this.apiKey=e.apiKey,this.sendApiKeyAsQueryParam=e.sendApiKeyAsQueryParam,this.cacheSearchResultsForSeconds=e.cacheSearchResultsForSeconds||0,this.useServerSideSearchCache=e.useServerSideSearchCache||false,this.axiosAdapter=e.axiosAdapter,this.logger=e.logger||Ze,this.logLevel=e.logLevel||"warn",this.logger.setLevel(this.logLevel),this.additionalHeaders=e.additionalHeaders,this.httpAgent=e.httpAgent,this.httpsAgent=e.httpsAgent,this.paramsSerializer=e.paramsSerializer,this.showDeprecationWarnings(e),this.validate();}validate(){if(this.nodes==null||this.nodes.length===0||this.validateNodes())throw new P("Ensure that nodes[].protocol, nodes[].host and nodes[].port are set");if(this.nearestNode!=null&&this.isNodeMissingAnyParameters(this.nearestNode))throw new P("Ensure that nearestNodes.protocol, nearestNodes.host and nearestNodes.port are set");if(this.apiKey==null)throw new P("Ensure that apiKey is set");return  true}validateNodes(){return this.nodes.some(e=>this.isNodeMissingAnyParameters(e))}isNodeMissingAnyParameters(e){return !["protocol","host","port","path"].every(t=>e.hasOwnProperty(t))&&e.url==null}setDefaultPathInNode(e){return e!=null&&!e.hasOwnProperty("path")&&(e.path=""),e}setDefaultPortInNode(e){if(e!=null&&!e.hasOwnProperty("port")&&e.hasOwnProperty("protocol"))switch(e.protocol){case "https":e.port=443;break;case "http":e.port=80;break}return e}showDeprecationWarnings(e){e.timeoutSeconds&&this.logger.warn("Deprecation warning: timeoutSeconds is now renamed to connectionTimeoutSeconds"),e.masterNode&&this.logger.warn("Deprecation warning: masterNode is now consolidated to nodes, starting with Typesense Server v0.12"),e.readReplicaNodes&&this.logger.warn("Deprecation warning: readReplicaNodes is now consolidated to nodes, starting with Typesense Server v0.12");}shuffleArray(e){for(let t=e.length-1;t>0;t--){let r=Math.floor(Math.random()*(t+1));[e[t],e[r]]=[e[r],e[t]];}}};var Me=be(Oe()),He=be(Ne());var _e={query_by:"query_by",query_by_weights:"query_by_weights",facet_by:"facet_by",group_by:"group_by",include_fields:"include_fields",exclude_fields:"exclude_fields",highlight_fields:"highlight_fields",highlight_full_fields:"highlight_full_fields",pinned_hits:"pinned_hits",hidden_hits:"hidden_hits",infix:"infix",override_tags:"override_tags",num_typos:"num_typos",prefix:"prefix",sort_by:"sort_by"};function Ue(n){return Object.keys(_e).filter(e=>n[e]!==void 0).every(e=>et(n[e]))}function C(n){let e={...n};if(!Object.keys(_e).filter(r=>Array.isArray(e[r])).map(r=>(e[r]=e[r].join(","),r)).length&&Ue(e))return e;if(!Ue(e))throw new Error(`Failed to normalize arrayable params: ${JSON.stringify(e)}`);return e}function et(n){return !Array.isArray(n)}function tt(n){return typeof n=="object"&&n!==null&&"message"in n&&typeof n.message=="string"}function qe(n){if(tt(n))return n;try{return typeof n=="string"?new Error(n):new Error(JSON.stringify(n))}catch{return new Error(String(n))}}var rt="X-TYPESENSE-API-KEY",Ae=true,nt=false,A=typeof process<"u"&&process.versions!=null&&process.versions.node!=null&&typeof window>"u",M=class{constructor(e){this.configuration=e;this.apiKey=this.configuration.apiKey,this.nodes=this.configuration.nodes==null?this.configuration.nodes:JSON.parse(JSON.stringify(this.configuration.nodes)),this.nearestNode=this.configuration.nearestNode==null?this.configuration.nearestNode:JSON.parse(JSON.stringify(this.configuration.nearestNode)),this.connectionTimeoutSeconds=this.configuration.connectionTimeoutSeconds,this.healthcheckIntervalSeconds=this.configuration.healthcheckIntervalSeconds,this.numRetriesPerRequest=this.configuration.numRetries,this.retryIntervalSeconds=this.configuration.retryIntervalSeconds,this.sendApiKeyAsQueryParam=this.configuration.sendApiKeyAsQueryParam,this.additionalUserHeaders=this.configuration.additionalHeaders,this.logger=this.configuration.logger,this.initializeMetadataForNodes(),this.currentNodeIndex=-1;}async get(e,t={},{abortSignal:r=null,responseType:s=void 0,streamConfig:i=void 0,isStreamingRequest:o}={}){return this.performRequest("get",e,{queryParameters:t,abortSignal:r,responseType:s,streamConfig:i,isStreamingRequest:o})}async delete(e,t={}){return this.performRequest("delete",e,{queryParameters:t,isStreamingRequest:false})}async post(e,t={},r={},s={},{abortSignal:i=null,responseType:o=void 0,streamConfig:a=void 0,isStreamingRequest:l}={}){return this.performRequest("post",e,{queryParameters:r,bodyParameters:t,additionalHeaders:s,abortSignal:i,responseType:o,streamConfig:a,isStreamingRequest:l})}async put(e,t={},r={}){return this.performRequest("put",e,{queryParameters:r,bodyParameters:t,isStreamingRequest:false})}async patch(e,t={},r={}){return this.performRequest("patch",e,{queryParameters:r,bodyParameters:t,isStreamingRequest:false})}getAdapter(){return this.configuration.axiosAdapter?typeof this.configuration.axiosAdapter=="function"?this.configuration.axiosAdapter:typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"?Se.getAdapter(this.configuration.axiosAdapter).bind(globalThis):Se.getAdapter(this.configuration.axiosAdapter):void 0}async performRequest(e,t,{queryParameters:r=null,bodyParameters:s=null,additionalHeaders:i={},abortSignal:o=null,responseType:a=void 0,skipConnectionTimeout:l=false,enableKeepAlive:g=void 0,streamConfig:S=void 0,isStreamingRequest:f}){this.configuration.validate(),f&&(this.logger.debug(`Request: Performing streaming request to ${t}`),!A&&typeof fetch<"u"&&(this.logger.debug("Using fetch adapter for browser streaming"),a="stream"));let p=Date.now(),b,Y=false;this.logger.debug(`Request #${p}: Performing ${e.toUpperCase()} request: ${t}`);for(let D=1;D<=this.numRetriesPerRequest+1;D++){let h=this.getNextNode(p);if(this.logger.debug(`Request #${p}: Attempting ${e.toUpperCase()} request Try #${D} to Node ${h.index}`),o&&o.aborted)return Promise.reject(new Error("Request aborted by caller."));let v;try{let c={method:e,url:this.uriFor(t,h),headers:Object.assign({},this.defaultHeaders(),i,this.additionalUserHeaders),maxContentLength:1/0,maxBodyLength:1/0,validateStatus:R=>R>0,transformResponse:[(R,T)=>{let Te=R;return T!==void 0&&typeof R=="string"&&T["content-type"]&&T["content-type"].startsWith("application/json")&&(Te=JSON.parse(R)),Te}]};if(c.adapter=f&&!A?"fetch":this.getAdapter(),l!==!0&&(c.timeout=this.connectionTimeoutSeconds*1e3),r&&Object.keys(r).length!==0&&(c.params=r),this.sendApiKeyAsQueryParam&&(c.params=c.params||{},c.params["x-typesense-api-key"]=this.apiKey),this.configuration.httpAgent?(this.logger.debug(`Request #${p}: Using custom httpAgent`),c.httpAgent=this.configuration.httpAgent):g===!0&&(A?(this.logger.debug(`Request #${p}: Enabling KeepAlive`),c.httpAgent=new Me.Agent({keepAlive:!0})):this.logger.warn(`Request #${p}: Cannot use custom httpAgent in a browser environment to enable keepAlive`)),this.configuration.httpsAgent?(this.logger.debug(`Request #${p}: Using custom httpsAgent`),c.httpsAgent=this.configuration.httpsAgent):g===!0&&(A?(this.logger.debug(`Request #${p}: Enabling keepAlive`),c.httpsAgent=new He.Agent({keepAlive:!0})):this.logger.warn(`Request #${p}: Cannot use custom httpAgent in a browser environment to enable keepAlive`)),this.configuration.paramsSerializer&&(this.logger.debug(`Request #${p}: Using custom paramsSerializer`),c.paramsSerializer=this.configuration.paramsSerializer),s&&(typeof s=="string"&&s.length!==0||typeof s=="object"&&Object.keys(s).length!==0)&&(c.data=s),o){let T=Se.CancelToken.source();v=()=>{Y=!0,T.cancel();},o.addEventListener("abort",v),c.cancelToken=T.token;}f?(c.responseType="stream",A||(c.headers={...c.headers,Accept:"text/event-stream"})):a&&(c.responseType=a);let d=await Se(c);if(d.status>=1&&d.status<=499&&this.setNodeHealthcheck(h,Ae),this.logger.debug(`Request #${p}: Request to Node ${h.index} was made. Response Code was ${d.status}.`),d.status>=200&&d.status<300)return f?this.handleStreamingResponse(d,S):Promise.resolve(d.data);if(d.status<500)return Promise.reject(this.customErrorForResponse(d,d.data?.message,c.data));throw this.customErrorForResponse(d,d.data?.message,c.data)}catch(c){if(Y||this.setNodeHealthcheck(h,nt),b=c,this.logger.warn(`Request #${p}: Request to Node ${h.index} failed due to "${c?.code??""} ${c.message}${c.response==null?"":" - "+JSON.stringify(c.response?.data)}"`),Y)return Promise.reject(new Error("Request aborted by caller."));if(f&&this.invokeOnErrorCallback(c,S),D<this.numRetriesPerRequest+1)this.logger.warn(`Request #${p}: Sleeping for ${this.retryIntervalSeconds}s and then retrying request...`);else return this.logger.debug(`Request #${p}: No retries left. Raising last error`),Promise.reject(b);await this.timer(this.retryIntervalSeconds);}finally{o&&v&&o.removeEventListener("abort",v);}}return this.logger.debug(`Request #${p}: No retries left. Raising last error`),Promise.reject(b)}processStreamingLine(e){if(!e.trim()||e==="data: [DONE]")return null;if(e.startsWith("data: "))return this.processDataLine(e.slice(6).trim());if(e.trim().startsWith("{"))try{let t=JSON.parse(e.trim());return t&&typeof t=="object"?(t.conversation_id||(t.conversation_id="unknown"),!t.message&&t.message!==""&&(t.message=""),t):{conversation_id:"unknown",message:JSON.stringify(t)}}catch{return {conversation_id:"unknown",message:e.trim()}}return {conversation_id:"unknown",message:e.trim()}}processDataLine(e){if(!e)return null;if(e.startsWith("{"))try{let t=JSON.parse(e);return t&&typeof t=="object"?(t.conversation_id||(t.conversation_id="unknown"),!t.message&&t.message!==""&&(t.message=""),t):{conversation_id:"unknown",message:JSON.stringify(t)}}catch{return {conversation_id:"unknown",message:e}}return {conversation_id:"unknown",message:e}}async handleStreamingResponse(e,t){return this.logger.debug(`Handling streaming response. Environment: ${A?"Node.js":"Browser"}`),A&&e.data?this.handleNodeStreaming(e,t):A?(this.logger.debug("Processing non-streaming response"),this.invokeOnCompleteCallback(e.data,t),Promise.resolve(e.data)):this.handleBrowserStreaming(e,t)}handleNodeStreaming(e,t){return this.logger.debug("Processing Node.js stream"),new Promise((r,s)=>{let i=e.data,o=[],a="";i.on("data",l=>{try{let g=l.toString();a+=g;let S=a.split(`
`);a=S.pop()??"",this.processStreamLines(S,o,t);}catch(g){s(g);}}),i.on("end",()=>{if(a.trim().length>0){let l=a.split(`
`);this.processStreamLines(l,o,t);}this.finalizeStreamResult(o,r,e,t);}),i.on("error",l=>{this.logger.error(`Stream error: ${l}`),this.invokeOnErrorCallback(l,t),s(l);});})}handleBrowserStreaming(e,t){return this.logger.debug("Processing browser stream"),new Promise(async(r,s)=>{try{return e.data&&typeof e.data.getReader=="function"?this.handleBrowserReadableStream(e.data,r,s,e,t):typeof e.data=="string"?this.handleBrowserStringResponse(e.data,r,e,t):typeof e.data=="object"&&e.data!==null?(this.logger.debug("No stream found, but data object is available"),this.invokeOnCompleteCallback(e.data,t),r(e.data)):(this.logger.error("No usable data found in response"),s(new Error("No usable data found in response")))}catch(i){this.logger.error(`Error processing streaming response: ${i}`),this.invokeOnErrorCallback(i,t),s(i);}})}async handleBrowserReadableStream(e,t,r,s,i){this.logger.debug("Found ReadableStream in response.data");let o=e.getReader(),a=[],l="";try{for(;;){let{done:g,value:S}=await o.read();if(g){if(this.logger.debug("Stream reading complete"),l.trim()){let b=l.split(`
`);this.processStreamLines(b,a,i);}break}let f=new TextDecoder().decode(S);this.logger.debug(`Received chunk: ${f.length} bytes`),l+=f;let p=l.split(`
`);l=p.pop()||"",this.processStreamLines(p,a,i);}this.finalizeStreamResult(a,t,s,i);}catch(g){this.logger.error(`Stream error: ${g}`),this.invokeOnErrorCallback(g,i),r(g);}}handleBrowserStringResponse(e,t,r,s){this.logger.debug("Processing text response as stream data");let i=[],o=e.split(`
`);if(this.processStreamLines(o,i,s),i.length>0){let a=this.combineStreamingChunks(i);this.invokeOnCompleteCallback(a,s),t(a);}else this.logger.debug("No chunks processed, returning original API response"),this.invokeOnCompleteCallback(r.data,s),t(r.data);}processStreamLines(e,t,r){for(let s of e)if(s.trim()&&s!=="data: [DONE]"){let i=this.processStreamingLine(s);i!==null&&(this.invokeOnChunkCallback(i,r),t.push(i));}}finalizeStreamResult(e,t,r,s){if(e.length>0){let i=this.combineStreamingChunks(e);this.logger.debug("Stream processing complete"),this.invokeOnCompleteCallback(i,s),t(i);}else this.logger.debug("No chunks processed, returning original API response"),this.invokeOnCompleteCallback(r.data,s),t(r.data);}combineStreamingChunks(e){if(e.length===0)return {};if(e.length===1)return e[0];let t=this.getMessageChunks(e);if(t.length>0)return this.combineMessageChunks(e,t);let r=e[e.length-1];if(!this.isCompleteSearchResponse(r))throw new Error("Last chunk is not a complete search response");return r}getMessageChunks(e){return e.filter(this.isChunkMessage)}isChunkMessage(e){return typeof e=="object"&&e!==null&&"message"in e&&"conversation_id"in e}combineMessageChunks(e,t){this.logger.debug(`Found ${t.length} message chunks to combine`);let r=e[e.length-1];if(this.isCompleteSearchResponse(r))return r;let s=e.find(this.isCompleteSearchResponse);if(!s)throw new Error("No metadata chunk found");return s}isCompleteSearchResponse(e){return typeof e=="object"&&e!==null&&Object.keys(e).length>0?"results"in e||"found"in e||"hits"in e||"page"in e||"search_time_ms"in e:false}getNextNode(e=0){if(this.nearestNode!=null){if(this.logger.debug(`Request #${e}: Nodes Health: Node ${this.nearestNode.index} is ${this.nearestNode.isHealthy===true?"Healthy":"Unhealthy"}`),this.nearestNode.isHealthy===true||this.nodeDueForHealthcheck(this.nearestNode,e))return this.logger.debug(`Request #${e}: Updated current node to Node ${this.nearestNode.index}`),this.nearestNode;this.logger.debug(`Request #${e}: Falling back to individual nodes`);}this.logger.debug(`Request #${e}: Nodes Health: ${this.nodes.map(r=>`Node ${r.index} is ${r.isHealthy===true?"Healthy":"Unhealthy"}`).join(" || ")}`);let t=this.nodes[0];for(let r=0;r<=this.nodes.length;r++)if(this.currentNodeIndex=(this.currentNodeIndex+1)%this.nodes.length,t=this.nodes[this.currentNodeIndex],t.isHealthy===true||this.nodeDueForHealthcheck(t,e))return this.logger.debug(`Request #${e}: Updated current node to Node ${t.index}`),t;return this.logger.debug(`Request #${e}: No healthy nodes were found. Returning the next node, Node ${t.index}`),t}nodeDueForHealthcheck(e,t=0){let r=Date.now()-e.lastAccessTimestamp>this.healthcheckIntervalSeconds*1e3;return r&&this.logger.debug(`Request #${t}: Node ${e.index} has exceeded healtcheckIntervalSeconds of ${this.healthcheckIntervalSeconds}. Adding it back into rotation.`),r}initializeMetadataForNodes(){this.nearestNode!=null&&(this.nearestNode.index="nearestNode",this.setNodeHealthcheck(this.nearestNode,Ae)),this.nodes.forEach((e,t)=>{e.index=t,this.setNodeHealthcheck(e,Ae);});}setNodeHealthcheck(e,t){e.isHealthy=t,e.lastAccessTimestamp=Date.now();}uriFor(e,t){return t.url!=null?`${t.url}${e}`:`${t.protocol}://${t.host}:${t.port}${t.path}${e}`}defaultHeaders(){let e={};return this.sendApiKeyAsQueryParam||(e[rt]=this.apiKey),e["Content-Type"]="application/json",e}async timer(e){return new Promise(t=>setTimeout(t,e*1e3))}customErrorForResponse(e,t,r){let s=`Request failed with HTTP code ${e.status}`;typeof t=="string"&&t.trim()!==""&&(s+=` | Server said: ${t}`);let i=new m(s,r,e.status);return e.status===400?i=new y(s,r,e.status):e.status===401?i=new N(s,r,e.status):e.status===404?i=new x(s,r,e.status):e.status===409?i=new O(s,r,e.status):e.status===422?i=new k(s,r,e.status):e.status>=500&&e.status<=599?i=new U(s,r,e.status):i=new E(s,r,e.status),i}invokeOnChunkCallback(e,t){if(t?.onChunk)try{t.onChunk(e);}catch(r){this.logger.warn(`Error in onChunk callback: ${r}`);}}invokeOnCompleteCallback(e,t){if(t?.onComplete)try{t.onComplete(e);}catch(r){this.logger.warn(`Error in onComplete callback: ${r}`);}}invokeOnErrorCallback(e,t){if(t?.onError){let r=qe(e);try{t.onError(r);}catch(s){this.logger.warn(`Error in onError callback: ${s}`);}}}};var st=2*60,it=100,H=class{constructor(){this.responseCache=new Map;this.responsePromiseCache=new Map;}clearCache(){this.responseCache=new Map,this.responsePromiseCache=new Map;}async perform(e,t,r,s){let{cacheResponseForSeconds:i=st,maxSize:o=it}=s,a=i<=0||o<=0,{path:l,queryParams:g,body:S,headers:f,streamConfig:p,abortSignal:b,responseType:Y,isStreamingRequest:D}=r;if(a)return this.executeRequest(e,t,l,g,S,f,{abortSignal:b,responseType:Y,streamConfig:p,isStreamingRequest:D});let h=JSON.stringify(r),v=this.responseCache.get(h),c=Date.now();if(v){if(c-v.requestTimestamp<i*1e3)return this.responseCache.delete(h),this.responseCache.set(h,v),v.response;this.responseCache.delete(h);}let d=this.responsePromiseCache.get(h);if(d){if(c-d.requestTimestamp<i*1e3)return this.responsePromiseCache.delete(h),this.responsePromiseCache.set(h,d),d.responsePromise;this.responsePromiseCache.delete(h);}let R=this.executeRequest(e,t,l,g,S,f,{abortSignal:b,responseType:Y,streamConfig:p,isStreamingRequest:D});this.responsePromiseCache.set(h,{requestTimestamp:c,responsePromise:R});let T=await R;if(this.responseCache.set(h,{requestTimestamp:c,response:T}),this.responseCache.size>o){let w=this.responseCache.keys().next().value;w&&this.responseCache.delete(w);}if(this.responsePromiseCache.size>o){let w=this.responsePromiseCache.keys().next().value;w&&this.responsePromiseCache.delete(w);}return T}executeRequest(e,t,r,s={},i,o,a){let l=e[t];switch(t){case "get":return l.call(e,r,s,{abortSignal:a?.abortSignal,responseType:a?.responseType,streamConfig:a?.streamConfig,isStreamingRequest:a?.isStreamingRequest});case "delete":return l.call(e,r,s);case "post":return l.call(e,r,i,s,o||{},{abortSignal:a?.abortSignal,responseType:a?.responseType,streamConfig:a?.streamConfig,isStreamingRequest:a?.isStreamingRequest});case "put":case "patch":return l.call(e,r,i,s);default:throw new Error(`Unsupported method: ${String(t)}`)}}};var ot="/multi_search",$=class{constructor(e,t,r=false){this.apiCall=e;this.configuration=t;this.useTextContentType=r;this.requestWithCache=new H;}clearCache(){this.requestWithCache.clearCache();}async perform(e,t,{cacheSearchResultsForSeconds:r=this.configuration.cacheSearchResultsForSeconds}={}){let s=t?{...t}:{};this.configuration.useServerSideSearchCache===true&&(s.use_cache=true);let i={union:e.union,searches:e.searches.map(C)},{streamConfig:o,...a}=s,l=C(a);return this.requestWithCache.perform(this.apiCall,"post",{path:ot,body:i,queryParams:l,headers:this.useTextContentType?{"content-type":"text/plain"}:{},streamConfig:o,isStreamingRequest:this.isStreamingRequest(s)},{cacheResponseForSeconds:r})}isStreamingRequest(e){return e.streamConfig!==void 0}};var De="/collections",u=class{constructor(e){this.apiCall=e;}async create(e,t){return this.apiCall.post(De,e,t)}async retrieve(e={}){return this.apiCall.get(De,e)}static get RESOURCEPATH(){return De}};var $e="/documents",G=class{constructor(e,t,r){this.collectionName=e;this.apiCall=t;this.configuration=r;this.requestWithCache=new H;}clearCache(){this.requestWithCache.clearCache();}async search(e,{cacheSearchResultsForSeconds:t=this.configuration.cacheSearchResultsForSeconds,abortSignal:r=null}={}){let s={};this.configuration.useServerSideSearchCache===true&&(s.use_cache=true);let{streamConfig:i,...o}=C(e),a={...s,...o},l=a.conversation_stream===true;return this.requestWithCache.perform(this.apiCall,"get",{path:this.endpointPath("search"),queryParams:a,streamConfig:i,abortSignal:r,isStreamingRequest:l},{cacheResponseForSeconds:t})}endpointPath(e){return `${u.RESOURCEPATH}/${encodeURIComponent(this.collectionName)}${$e}${e===void 0?"":"/"+e}`}static get RESOURCEPATH(){return $e}};var ye=class{constructor(e,t,r){this.name=e;this.apiCall=t;this.configuration=r;this._documents=new G(this.name,this.apiCall,this.configuration);}documents(){return this._documents}};var Ce=class{constructor(e){e.sendApiKeyAsQueryParam=e.sendApiKeyAsQueryParam??true,e.sendApiKeyAsQueryParam===true&&(e.apiKey||"").length>2e3&&(console.warn("[typesense] API Key is longer than 2000 characters which is over the allowed limit, so disabling sending it as a query parameter."),e.sendApiKeyAsQueryParam=false),this.configuration=new q(e),this.apiCall=new M(this.configuration),this.multiSearch=new $(this.apiCall,this.configuration,true),this.individualCollections={};}clearCache(){this.multiSearch.clearCache(),Object.entries(this.individualCollections).forEach(([e,t])=>{t.documents().clearCache();});}collections(e){if(e)return this.individualCollections[e]===void 0&&(this.individualCollections[e]=new ye(e,this.apiCall,this.configuration)),this.individualCollections[e];throw new Error("Typesense.SearchClient only supports search operations, so the collectionName that needs to be searched must be specified. Use Typesense.Client if you need to access the collection object.")}};var Ie=typeof process<"u"&&process.versions!=null&&process.versions.node!=null,I=class extends G{constructor(e,t,r){super(e,t,r);}async create(e,t={}){if(!e)throw new Error("No document provided");return this.apiCall.post(this.endpointPath(),e,t)}async upsert(e,t={}){if(!e)throw new Error("No document provided");return this.apiCall.post(this.endpointPath(),e,Object.assign({},t,{action:"upsert"}))}async update(e,t={}){if(!e)throw new Error("No document provided");return t.filter_by!=null?this.apiCall.patch(this.endpointPath(),e,Object.assign({},t)):this.apiCall.post(this.endpointPath(),e,Object.assign({},t,{action:"update"}))}async delete(e={}){return this.apiCall.delete(this.endpointPath(),e)}async createMany(e,t={}){return this.configuration.logger.warn("createMany is deprecated and will be removed in a future version. Use import instead, which now takes both an array of documents or a JSONL string of documents"),this.import(e,t)}async import(e,t={}){let r;if(Array.isArray(e)){if(e.length===0)throw new y("No documents provided");try{r=e.map(i=>JSON.stringify(i)).join(`
`);}catch(i){throw i instanceof RangeError&&i.message.includes("Too many properties to enumerate")?new Error(`${i}
          It looks like you have reached a Node.js limit that restricts the number of keys in an Object: https://stackoverflow.com/questions/9282869/are-there-limits-to-the-number-of-properties-in-a-javascript-object

         Please try reducing the number of keys in your document, or using CURL to import your data.
          `):new Error(i)}}else if(r=e,at(r))throw new y("No documents provided");let s=await this.apiCall.performRequest("post",this.endpointPath("import"),{queryParameters:t,bodyParameters:r,additionalHeaders:{"Content-Type":"text/plain"},skipConnectionTimeout:true,enableKeepAlive:!!Ie});if(Array.isArray(e)){let i=s.split(`
`).map(a=>JSON.parse(a)),o=i.filter(a=>a.success===false);if(o.length>0)throw new _(`${i.length-o.length} documents imported successfully, ${o.length} documents failed during import. Use \`error.importResults\` from the raised exception to get a detailed error reason for each document.`,i,{documentsInJSONLFormat:r,options:t,failedItems:o,successCount:i.length-o.length});return i}else return s}async importStream(e,t={}){let s=(await this.apiCall.performRequest("post",this.endpointPath("import"),{queryParameters:t,bodyParameters:e,additionalHeaders:{"Content-Type":"text/plain"},skipConnectionTimeout:true,enableKeepAlive:!!Ie})).split(`
`).map(o=>JSON.parse(o)),i=s.filter(o=>o.success===false);if(i.length>0)throw new _(`${s.length-i.length} documents imported successfully, ${i.length} documents failed during import. Use \`error.importResults\` from the raised exception to get a detailed error reason for each document.`,s,{documentsInJSONLFormat:e,options:t,failedItems:i,successCount:s.length-i.length});return s}async export(e={}){return this.apiCall.get(this.endpointPath("export"),e)}async exportStream(e={}){return this.apiCall.get(this.endpointPath("export"),e,{responseType:"stream"})}};function at(n){return n==null||n===""||n.length===0}var ct="/overrides",W=class n{constructor(e,t){this.collectionName=e;this.apiCall=t;}async upsert(e,t){return this.apiCall.put(this.endpointPath(e),t)}async retrieve(){return this.apiCall.get(this.endpointPath())}endpointPath(e){return `${u.RESOURCEPATH}/${this.collectionName}${n.RESOURCEPATH}${e===void 0?"":"/"+encodeURIComponent(e)}`}static get RESOURCEPATH(){return ct}};var X=class{constructor(e,t,r){this.collectionName=e;this.overrideId=t;this.apiCall=r;}async retrieve(){return this.apiCall.get(this.endpointPath())}async delete(){return this.apiCall.delete(this.endpointPath())}endpointPath(){return `${u.RESOURCEPATH}/${encodeURIComponent(this.collectionName)}${W.RESOURCEPATH}/${encodeURIComponent(this.overrideId)}`}};var lt="/synonyms",K=class n{constructor(e,t){this.collectionName=e;this.apiCall=t;}async upsert(e,t){return this.apiCall.put(this.endpointPath(e),t)}async retrieve(){return this.apiCall.get(this.endpointPath())}endpointPath(e){return `${u.RESOURCEPATH}/${encodeURIComponent(this.collectionName)}${n.RESOURCEPATH}${e===void 0?"":"/"+encodeURIComponent(e)}`}static get RESOURCEPATH(){return lt}};var Z=class{constructor(e,t,r){this.collectionName=e;this.synonymId=t;this.apiCall=r;}async retrieve(){return this.apiCall.get(this.endpointPath())}async delete(){return this.apiCall.delete(this.endpointPath())}endpointPath(){return `${u.RESOURCEPATH}/${encodeURIComponent(this.collectionName)}${K.RESOURCEPATH}/${encodeURIComponent(this.synonymId)}`}};var ve=class{constructor(e,t,r){this.collectionName=e;this.documentId=t;this.apiCall=r;}async retrieve(){return this.apiCall.get(this.endpointPath())}async delete(e){return this.apiCall.delete(this.endpointPath(),e)}async update(e,t={}){return this.apiCall.patch(this.endpointPath(),e,t)}endpointPath(){return `${u.RESOURCEPATH}/${encodeURIComponent(this.collectionName)}${I.RESOURCEPATH}/${encodeURIComponent(this.documentId)}`}};var ee=class{constructor(e,t,r){this.name=e;this.apiCall=t;this.configuration=r;this.individualDocuments={};this.individualOverrides={};this.individualSynonyms={};this.name=e,this.apiCall=t,this.configuration=r,this._documents=new I(this.name,this.apiCall,this.configuration),this._overrides=new W(this.name,this.apiCall),this._synonyms=new K(this.name,this.apiCall);}async retrieve(){return this.apiCall.get(this.endpointPath())}async update(e){return this.apiCall.patch(this.endpointPath(),e)}async delete(e={}){return this.apiCall.delete(this.endpointPath(),e)}async exists(){try{return await this.retrieve(),!0}catch(e){if(e instanceof x)return  false;throw e}}documents(e){return e?(this.individualDocuments[e]===void 0&&(this.individualDocuments[e]=new ve(this.name,e,this.apiCall)),this.individualDocuments[e]):this._documents}overrides(e){return e===void 0?this._overrides:(this.individualOverrides[e]===void 0&&(this.individualOverrides[e]=new X(this.name,e,this.apiCall)),this.individualOverrides[e])}synonyms(e){return e===void 0?this._synonyms:(this.individualSynonyms[e]===void 0&&(this.individualSynonyms[e]=new Z(this.name,e,this.apiCall)),this.individualSynonyms[e])}endpointPath(){return `${u.RESOURCEPATH}/${encodeURIComponent(this.name)}`}};var We="/aliases",j=class n{constructor(e){this.apiCall=e;}async upsert(e,t){return this.apiCall.put(this.endpointPath(e),t)}async retrieve(){return this.apiCall.get(We)}endpointPath(e){return `${n.RESOURCEPATH}/${encodeURIComponent(e)}`}static get RESOURCEPATH(){return We}};var te=class{constructor(e,t){this.name=e;this.apiCall=t;}async retrieve(){return this.apiCall.get(this.endpointPath())}async delete(){return this.apiCall.delete(this.endpointPath())}endpointPath(){return `${j.RESOURCEPATH}/${encodeURIComponent(this.name)}`}};var ze=be(je());var Fe="/keys",F=class n{constructor(e){this.apiCall=e;this.apiCall=e;}async create(e){return this.apiCall.post(n.RESOURCEPATH,e)}async retrieve(){return this.apiCall.get(Fe)}generateScopedSearchKey(e,t){let r=C(t),s=JSON.stringify(r),i=Buffer.from((0, ze.createHmac)("sha256",e).update(s).digest("base64")),o=e.substr(0,4),a=`${i}${o}${s}`;return Buffer.from(a).toString("base64")}static get RESOURCEPATH(){return Fe}};var re=class{constructor(e,t){this.id=e;this.apiCall=t;}async retrieve(){return this.apiCall.get(this.endpointPath())}async delete(){return this.apiCall.delete(this.endpointPath())}endpointPath(){return `${F.RESOURCEPATH}/${encodeURIComponent(this.id)}`}};var mt="/debug",ne=class{constructor(e){this.apiCall=e;}async retrieve(){return this.apiCall.get(mt)}};var pt="/metrics.json",se=class{constructor(e){this.apiCall=e;}async retrieve(){return this.apiCall.get(pt)}};var ut="/stats.json",ie=class{constructor(e){this.apiCall=e;}async retrieve(){return this.apiCall.get(ut)}};var ht="/health",oe=class{constructor(e){this.apiCall=e;}async retrieve(){return this.apiCall.get(ht)}};var dt="/operations",ae=class{constructor(e){this.apiCall=e;}async perform(e,t={}){return this.apiCall.post(`${dt}/${e}`,{},t)}};var gt="/presets",z=class n{constructor(e){this.apiCall=e;}async upsert(e,t){if(typeof t.value=="object"&&"searches"in t.value){let s=t.value.searches.map(i=>C(i));return this.apiCall.put(this.endpointPath(e),{value:{searches:s}})}let r=C(t.value);return this.apiCall.put(this.endpointPath(e),{value:r})}async retrieve(){return this.apiCall.get(this.endpointPath())}endpointPath(e){return `${n.RESOURCEPATH}${e===void 0?"":"/"+encodeURIComponent(e)}`}static get RESOURCEPATH(){return gt}};var ce=class{constructor(e,t){this.presetId=e;this.apiCall=t;}async retrieve(){return this.apiCall.get(this.endpointPath())}async delete(){return this.apiCall.delete(this.endpointPath())}endpointPath(){return `${z.RESOURCEPATH}/${encodeURIComponent(this.presetId)}`}};var ft="/analytics/rules",L=class n{constructor(e){this.apiCall=e;this.apiCall=e;}async upsert(e,t){return this.apiCall.put(this.endpointPath(e),t)}async retrieve(){return this.apiCall.get(this.endpointPath())}endpointPath(e){return `${n.RESOURCEPATH}${e===void 0?"":"/"+encodeURIComponent(e)}`}static get RESOURCEPATH(){return ft}};var le=class{constructor(e,t){this.name=e;this.apiCall=t;}async retrieve(){return this.apiCall.get(this.endpointPath())}async delete(){return this.apiCall.delete(this.endpointPath())}endpointPath(){return `${L.RESOURCEPATH}/${encodeURIComponent(this.name)}`}};var St="/analytics/events",me=class n{constructor(e){this.apiCall=e;this.apiCall=e;}async create(e){return this.apiCall.post(this.endpointPath(),e)}endpointPath(e){return `${n.RESOURCEPATH}${e===void 0?"":"/"+encodeURIComponent(e)}`}static get RESOURCEPATH(){return St}};var yt="/analytics",pe=class{constructor(e){this.apiCall=e;this.individualAnalyticsRules={};this.apiCall=e,this._analyticsRules=new L(this.apiCall),this._analyticsEvents=new me(this.apiCall);}rules(e){return e===void 0?this._analyticsRules:(this.individualAnalyticsRules[e]===void 0&&(this.individualAnalyticsRules[e]=new le(e,this.apiCall)),this.individualAnalyticsRules[e])}events(){return this._analyticsEvents}static get RESOURCEPATH(){return yt}};var Ct="/stopwords",B=class n{constructor(e){this.apiCall=e;}async upsert(e,t){return this.apiCall.put(this.endpointPath(e),t)}async retrieve(){return this.apiCall.get(this.endpointPath())}endpointPath(e){return `${n.RESOURCEPATH}${e===void 0?"":"/"+encodeURIComponent(e)}`}static get RESOURCEPATH(){return Ct}};var ue=class{constructor(e,t){this.stopwordId=e;this.apiCall=t;}async retrieve(){return this.apiCall.get(this.endpointPath())}async delete(){return this.apiCall.delete(this.endpointPath())}endpointPath(){return `${B.RESOURCEPATH}/${encodeURIComponent(this.stopwordId)}`}};var vt="/conversations/models",J=class n{constructor(e){this.apiCall=e;this.apiCall=e;}async create(e){return this.apiCall.post(this.endpointPath(),e)}async retrieve(){return this.apiCall.get(this.endpointPath())}endpointPath(e){return `${n.RESOURCEPATH}${e===void 0?"":"/"+encodeURIComponent(e)}`}static get RESOURCEPATH(){return vt}};var he=class{constructor(e,t){this.id=e;this.apiCall=t;}async update(e){return this.apiCall.put(this.endpointPath(),e)}async retrieve(){return this.apiCall.get(this.endpointPath())}async delete(){return this.apiCall.delete(this.endpointPath())}endpointPath(){return `${J.RESOURCEPATH}/${encodeURIComponent(this.id)}`}};var Le="/conversations",Q=class{constructor(e){this.apiCall=e;this.individualConversationModels={};this.apiCall=e,this._conversationsModels=new J(this.apiCall);}async retrieve(){return this.apiCall.get(Le)}models(e){return e===void 0?this._conversationsModels:(this.individualConversationModels[e]===void 0&&(this.individualConversationModels[e]=new he(e,this.apiCall)),this.individualConversationModels[e])}static get RESOURCEPATH(){return Le}};var de=class{constructor(e,t){this.id=e;this.apiCall=t;}async retrieve(){return this.apiCall.get(this.endpointPath())}async update(e){return this.apiCall.put(this.endpointPath(),e)}async delete(){return this.apiCall.delete(this.endpointPath())}endpointPath(){return `${Q.RESOURCEPATH}/${encodeURIComponent(this.id)}`}};var Rt="/stemming/dictionaries",V=class n{constructor(e){this.apiCall=e;this.apiCall=e;}async upsert(e,t){let r=Array.isArray(t)?t.map(i=>JSON.stringify(i)).join(`
`):t,s=await this.apiCall.performRequest("post",this.endpointPath("import"),{queryParameters:{id:e},bodyParameters:r,additionalHeaders:{"Content-Type":"text/plain"},skipConnectionTimeout:true});return Array.isArray(t)?s.split(`
`).map(i=>JSON.parse(i)):s}async retrieve(){return this.apiCall.get(this.endpointPath())}endpointPath(e){return e===void 0?`${n.RESOURCEPATH}`:`${n.RESOURCEPATH}/${encodeURIComponent(e)}`}static get RESOURCEPATH(){return Rt}};var ge=class{constructor(e,t){this.id=e;this.apiCall=t;}async retrieve(){return this.apiCall.get(this.endpointPath())}endpointPath(){return `${V.RESOURCEPATH}/${encodeURIComponent(this.id)}`}};var Tt="/stemming",fe=class{constructor(e){this.apiCall=e;this.individualStemmingDictionaries={};this.apiCall=e,this._stemmingDictionaries=new V(this.apiCall);}dictionaries(e){return e===void 0?this._stemmingDictionaries:(this.individualStemmingDictionaries[e]===void 0&&(this.individualStemmingDictionaries[e]=new ge(e,this.apiCall)),this.individualStemmingDictionaries[e])}static get RESOURCEPATH(){return Tt}};var Re=class{constructor(e){e.sendApiKeyAsQueryParam=e.sendApiKeyAsQueryParam??false,this.configuration=new q(e),this.apiCall=new M(this.configuration),this.debug=new ne(this.apiCall),this.metrics=new se(this.apiCall),this.stats=new ie(this.apiCall),this.health=new oe(this.apiCall),this.operations=new ae(this.apiCall),this.multiSearch=new $(this.apiCall,this.configuration),this._collections=new u(this.apiCall),this.individualCollections={},this._aliases=new j(this.apiCall),this.individualAliases={},this._keys=new F(this.apiCall),this.individualKeys={},this._presets=new z(this.apiCall),this.individualPresets={},this._stopwords=new B(this.apiCall),this.individualStopwords={},this.analytics=new pe(this.apiCall),this.stemming=new fe(this.apiCall),this._conversations=new Q(this.apiCall),this.individualConversations={};}collections(e){return e===void 0?this._collections:(this.individualCollections[e]===void 0&&(this.individualCollections[e]=new ee(e,this.apiCall,this.configuration)),this.individualCollections[e])}aliases(e){return e===void 0?this._aliases:(this.individualAliases[e]===void 0&&(this.individualAliases[e]=new te(e,this.apiCall)),this.individualAliases[e])}keys(e){return e===void 0?this._keys:(this.individualKeys[e]===void 0&&(this.individualKeys[e]=new re(e,this.apiCall)),this.individualKeys[e])}presets(e){return e===void 0?this._presets:(this.individualPresets[e]===void 0&&(this.individualPresets[e]=new ce(e,this.apiCall)),this.individualPresets[e])}stopwords(e){return e===void 0?this._stopwords:(this.individualStopwords[e]===void 0&&(this.individualStopwords[e]=new ue(e,this.apiCall)),this.individualStopwords[e])}conversations(e){return e===void 0?this._conversations:(this.individualConversations[e]===void 0&&(this.individualConversations[e]=new de(e,this.apiCall)),this.individualConversations[e])}};export{Re as Client,we as Errors,Ce as SearchClient};//# sourceMappingURL=index.min.mjs.map
//# sourceMappingURL=index.min.mjs.map